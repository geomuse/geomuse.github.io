---
layout: post
title:  telegram bot 按钮交互功能
date:   2025-01-14 10:24:29 +0800
categories: 
    - python
    - telegram
---

## 📅 **Day 11：实现按钮交互功能**

在这一天，你将学习如何为 Telegram Bot 添加 **交互式按钮（Inline Keyboard）**，实现用户点击按钮后触发相应的 Bot 响应。交互式按钮可以大大提升 Bot 的用户体验，比如用于 **菜单导航、选项选择、问卷调查等**。

---

### 🎯 **Day 11 学习目标**
1. 学习如何创建 **Inline Keyboard 按钮**。
2. 处理按钮的 **回调数据**。
3. 根据用户点击的按钮执行相应的操作。

---

### ✅ **步骤 1：创建 Inline Keyboard 按钮**

使用 `InlineKeyboardButton` 和 `InlineKeyboardMarkup` 创建交互式按钮。

#### 📋 **代码示例：创建简单的按钮**
```python
from telegram import InlineKeyboardButton, InlineKeyboardMarkup, Update
from telegram.ext import ApplicationBuilder, CommandHandler, CallbackQueryHandler, ContextTypes

# 定义 /start 命令，发送带按钮的消息
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # 创建按钮
    keyboard = [
        [
            InlineKeyboardButton("Option 1", callback_data='1'),
            InlineKeyboardButton("Option 2", callback_data='2'),
        ],
        [
            InlineKeyboardButton("Option 3", callback_data='3'),
        ]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    # 发送带按钮的消息
    await update.message.reply_text("Please choose an option:", reply_markup=reply_markup)

# 处理按钮点击后的回调
async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    # 根据用户点击的按钮执行不同的操作
    if query.data == '1':
        await query.edit_message_text(text="You selected Option 1!")
    elif query.data == '2':
        await query.edit_message_text(text="You selected Option 2!")
    elif query.data == '3':
        await query.edit_message_text(text="You selected Option 3!")

# 启动 Bot 应用程序
if __name__ == '__main__':
    app = ApplicationBuilder().token("YOUR_BOT_TOKEN").build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CallbackQueryHandler(button_callback))
    app.run_polling()
```

---

### 🔎 **代码解析**

| **代码片段**              | **功能描述**                                   |
|---------------------------|-----------------------------------------------|
| `InlineKeyboardButton`     | 创建一个按钮，包含文本和回调数据                |
| `InlineKeyboardMarkup`     | 将按钮组织成一组，作为消息的回复选项            |
| `CallbackQueryHandler`     | 处理用户点击按钮后的回调                      |
| `callback_data`            | 用户点击按钮时传递的数据                     |
| `query.answer()`           | 回应用户的按钮点击事件                        |
| `query.edit_message_text`  | 修改原消息的文本                               |

---

### ✅ **步骤 2：运行 Bot 并测试**

#### 📋 **测试方法**
1. 在 Telegram 中启动你的 Bot。
2. 发送 `/start` 命令。
3. 点击按钮并查看 Bot 的响应。

---

### 🎯 **进阶：根据用户选择执行不同的操作**

你可以根据用户选择的按钮，执行不同的操作，比如显示不同的菜单、提供不同的选项等。

#### 📋 **代码示例：菜单导航**
```python
from telegram import InlineKeyboardButton, InlineKeyboardMarkup, Update
from telegram.ext import ApplicationBuilder, CommandHandler, CallbackQueryHandler, ContextTypes

# 定义 /start 命令，发送主菜单
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    keyboard = [
        [InlineKeyboardButton("Menu 1", callback_data='menu1')],
        [InlineKeyboardButton("Menu 2", callback_data='menu2')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text("Main Menu:", reply_markup=reply_markup)

# 处理按钮回调，显示不同菜单
async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    if query.data == 'menu1':
        await query.edit_message_text(text="You selected Menu 1!")
    elif query.data == 'menu2':
        await query.edit_message_text(text="You selected Menu 2!")

# 启动 Bot 应用程序
if __name__ == '__main__':
    app = ApplicationBuilder().token("YOUR_BOT_TOKEN").build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CallbackQueryHandler(button_callback))
    app.run_polling()
```

---

### ✅ **Day 11 总结**

| **功能**                  | **描述**                                 |
|---------------------------|-----------------------------------------|
| 创建 Inline Keyboard 按钮 | 使用 `InlineKeyboardButton` 和 `InlineKeyboardMarkup` 创建按钮 |
| 处理按钮点击回调           | 使用 `CallbackQueryHandler` 处理回调事件 |
| 动态修改消息文本           | 使用 `query.edit_message_text()` 修改消息 |

---

### 🎯 **Day 11 作业**
1. 修改代码，使 Bot 提供一个 **3 层嵌套菜单**。
2. 添加一个 **返回上一级菜单** 的按钮。

完成后，你的 Telegram Bot 将具备 **交互式按钮功能**，能够根据用户的选择动态响应，并显示不同的菜单或信息。

需要更多帮助？随时提问！ 😊