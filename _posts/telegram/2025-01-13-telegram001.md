---
layout: post
title:  telegram bot 文本消息处理
date:   2025-01-13 10:24:29 +0800
categories: 
    - python
    - telegram
---

### 📅 **Day 6-10：常见功能实现**

在这阶段，你将学习如何在 Telegram Bot 中实现 **命令处理、文本消息处理、自定义回复、简单状态管理和错误处理** 等功能。这些是大多数 Telegram Bot 的核心功能。

---

## ✅ **Day 6：处理命令和自定义回复**

### 🎯 **目标**
- 理解如何处理用户输入的命令
- 实现自定义命令的回复

### 📋 **代码示例：命令处理**
使用 `CommandHandler` 来捕获用户输入的命令。

#### ✅ **实现 `/help` 命令**
```python
from telegram import Update
from telegram.ext import ApplicationBuilder, CommandHandler, ContextTypes

# 定义帮助命令的函数
async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("Here are the available commands:\n/start - Start the bot\n/help - Get help")

# Bot 应用程序
app = ApplicationBuilder().token("YOUR_BOT_TOKEN").build()
app.add_handler(CommandHandler('help', help_command))

app.run_polling()
```

---

## ✅ **Day 7：处理文本消息**

### 🎯 **目标**
- 学习如何处理用户发送的 **文本消息**
- 实现一个 **回声（Echo）Bot**

### 📋 **代码示例：处理文本消息**
使用 `MessageHandler` 捕获用户发送的文本消息。

#### ✅ **实现回声（Echo）功能**
```python
from telegram import Update
from telegram.ext import ApplicationBuilder, MessageHandler, filters, ContextTypes

# 定义文本消息处理函数
async def echo(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_message = update.message.text
    await update.message.reply_text(f"You said: {user_message}")

# Bot 应用程序
app = ApplicationBuilder().token("YOUR_BOT_TOKEN").build()
app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, echo))

app.run_polling()
```

---

## ✅ **Day 8：自定义回复和条件判断**

### 🎯 **目标**
- 根据用户输入的内容进行不同的回复
- 实现简单的 **条件判断**

### 📋 **代码示例：条件判断回复**
```python
from telegram import Update
from telegram.ext import ApplicationBuilder, MessageHandler, filters, ContextTypes

# 定义文本消息处理函数
async def custom_reply(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_message = update.message.text.lower()
    
    if "hello" in user_message:
        await update.message.reply_text("Hi there! How can I help you?")
    elif "bye" in user_message:
        await update.message.reply_text("Goodbye! Have a great day!")
    else:
        await update.message.reply_text("Sorry, I don't understand that.")

# Bot 应用程序
app = ApplicationBuilder().token("YOUR_BOT_TOKEN").build()
app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, custom_reply))

app.run_polling()
```

---

## ✅ **Day 9：状态管理**

### 🎯 **目标**
- 学习如何管理用户的状态
- 实现一个简单的 **问答互动 Bot**

### 📋 **代码示例：简单状态管理**
```python
from telegram import Update
from telegram.ext import ApplicationBuilder, MessageHandler, filters, ContextTypes

# 定义一个字典来存储用户状态
user_states = {}

# 定义消息处理函数
async def question_bot(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.message.from_user.id
    user_message = update.message.text

    if user_id not in user_states:
        user_states[user_id] = 'ask_name'
        await update.message.reply_text("Hello! What's your name?")
    elif user_states[user_id] == 'ask_name':
        user_states[user_id] = 'ask_age'
        await update.message.reply_text(f"Nice to meet you, {user_message}! How old are you?")
    elif user_states[user_id] == 'ask_age':
        await update.message.reply_text(f"Great! So you're {user_message} years old. Nice chatting with you!")
        del user_states[user_id]  # 清除状态

# Bot 应用程序
app = ApplicationBuilder().token("YOUR_BOT_TOKEN").build()
app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, question_bot))

app.run_polling()
```

---

## ✅ **Day 10：错误处理**

### 🎯 **目标**
- 学习如何捕获和处理 Bot 运行时的 **错误**
- 提升 Bot 的稳定性

### 📋 **代码示例：错误处理**
使用 `Application` 的 `add_error_handler` 来捕获错误。

#### ✅ **实现错误处理函数**
```python
from telegram import Update
from telegram.ext import ApplicationBuilder, MessageHandler, filters, ContextTypes

# 定义错误处理函数
async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    print(f"Error: {context.error}")
    if update:
        await update.message.reply_text("Oops! Something went wrong. Please try again.")

# 定义回声函数
async def echo(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(update.message.text)

# Bot 应用程序
app = ApplicationBuilder().token("YOUR_BOT_TOKEN").build()
app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, echo))
app.add_error_handler(error_handler)

app.run_polling()
```

---

## 📌 **Day 6-10 复习总结**

| Day | 主题                     | 任务                         |
|-----|--------------------------|------------------------------|
| 6   | 命令处理                 | 创建 `/start` 和 `/help` 命令 |
| 7   | 文本消息处理             | 实现回声（Echo）功能          |
| 8   | 自定义回复和条件判断     | 实现不同消息的条件判断回复    |
| 9   | 状态管理                 | 实现简单的问答互动 Bot        |
| 10  | 错误处理                 | 捕获和处理 Bot 的错误         |

完成这 5 天的学习后，你的 Telegram Bot 已经能够：
1. 接收并回复用户的命令和消息。
2. 根据用户输入进行条件判断。
3. 记录和管理用户的状态。
4. 处理可能发生的错误。

下一阶段将进入更高级的功能，比如 **按钮交互、文件处理和数据库集成**。如果你有问题或想要具体的代码优化建议，欢迎随时提问！ 😊